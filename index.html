<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Raw Dub System</title>
    <style>
        * { touch-action: none !important; -webkit-tap-highlight-color: transparent; box-sizing: border-box; overscroll-behavior: none !important; }
        html, body { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; margin: 0; padding: 0; background: #050505; overflow: hidden !important; }
        body { display: flex; flex-direction: column; align-items: center; justify-content: center; color: #eee; font-family: 'Courier New', Courier, monospace; user-select: none; -webkit-user-select: none; }
        
        .pad-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; width: 90vw; max-width: 360px; }
        .pad {
            aspect-ratio: 1 / 1; background: #111; border: 2px solid #333; border-radius: 4px;
            display: flex; align-items: center; justify-content: center; font-size: 10px; color: #ff3e3e; font-weight: bold;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        }
        .pad:active { background: #ff3e3e; color: #000; box-shadow: 0 0 20px #ff3e3e; transform: scale(0.96); }

        #start-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; display: flex; align-items: center; justify-content: center; z-index: 2000; }
        #start-button { padding: 30px 60px; font-size: 20px; font-weight: bold; background: #ff3e3e; border: none; color: #000; letter-spacing: 2px; }
    </style>
</head>
<body>
    <div id="start-overlay"><button id="start-button" onpointerdown="initApp(event)">CONNECT SYSTEM</button></div>

    <div style="color: #ff3e3e; margin-bottom: 20px; letter-spacing: 5px;">DUB WARRIOR</div>

    <div class="pad-grid">
        <div class="pad" onpointerdown="play('siren', event)">DUB SIREN</div>
        <div class="pad" onpointerdown="play('laser', event)">LASER</div>
        <div class="pad" onpointerdown="play('ufo', event)">UFO SCAN</div>
        <div class="pad" onpointerdown="play('kick', event)">DEEP KICK</div>
        <div class="pad" onpointerdown="play('snare', event)">REVERB SNR</div>
        <div class="pad" onpointerdown="play('clap', event)">DRY CLAP</div>
        <div class="pad" onpointerdown="play('sub', event)">SUB DROP</div>
        <div class="pad" onpointerdown="play('noise', event)">WHITE DUST</div>
        <div class="pad" onpointerdown="play('echo', event)">KILLER ECHO</div>
    </div>

    <script>
        let ctx;
        function initApp(e) {
            e.preventDefault();
            ctx = new (window.AudioContext || window.webkitAudioContext)();
            document.getElementById('start-overlay').style.display = 'none';
        }

        function play(type, e) {
            if (!ctx) return;
            e.preventDefault(); e.stopPropagation();
            const t = ctx.currentTime;

            // 共通のエコー（ディレイ）ユニット
            const delay = ctx.createDelay();
            delay.delayTime.value = 0.25;
            const feedback = ctx.createGain();
            feedback.gain.value = 0.4; // 繰り返しの強さ
            
            const mainGain = ctx.createGain();
            const osc = ctx.createOscillator();
            const filter = ctx.createBiquadFilter();

            switch(type) {
                case 'siren': // ポワワワワン！
                    osc.frequency.setValueAtTime(440, t);
                    osc.frequency.exponentialRampToValueAtTime(880, t + 0.1);
                    osc.frequency.exponentialRampToValueAtTime(440, t + 0.2);
                    mainGain.gain.setValueAtTime(0.3, t);
                    mainGain.gain.exponentialRampToValueAtTime(0.01, t + 0.4);
                    // ディレイに送る
                    mainGain.connect(delay); delay.connect(feedback); feedback.connect(delay); delay.connect(ctx.destination);
                    break;

                case 'laser': // 鋭いレーザー
                    osc.type = 'sawtooth';
                    osc.frequency.setValueAtTime(1500, t);
                    osc.frequency.exponentialRampToValueAtTime(10, t + 0.15);
                    mainGain.gain.setValueAtTime(0.2, t);
                    break;

                case 'kick': // 腹に響くキック
                    osc.frequency.setValueAtTime(150, t);
                    osc.frequency.exponentialRampToValueAtTime(40, t + 0.1);
                    filter.type = 'lowpass';
                    filter.frequency.value = 100;
                    mainGain.gain.setValueAtTime(1, t);
                    mainGain.gain.exponentialRampToValueAtTime(0.01, t + 0.3);
                    osc.connect(filter); filter.connect(mainGain);
                    break;

                case 'snare': // 残響スネア
                    const b = ctx.createBuffer(1, ctx.sampleRate * 0.2, ctx.sampleRate);
                    const d = b.getChannelData(0);
                    for (let i = 0; i < b.length; i++) d[i] = (Math.random() * 2 - 1) * Math.exp(-i / 2000);
                    const s = ctx.createBufferSource(); s.buffer = b;
                    const f2 = ctx.createBiquadFilter(); f2.type = 'highpass'; f2.frequency.value = 1000;
                    s.connect(f2); f2.connect(mainGain);
                    s.start(t);
                    // エコー追加
                    mainGain.connect(delay); delay.connect(feedback); feedback.connect(delay); delay.connect(ctx.destination);
                    break;

                case 'sub': // 地響きサブベース
                    osc.frequency.setValueAtTime(60, t);
                    osc.frequency.linearRampToValueAtTime(20, t + 0.8);
                    mainGain.gain.setValueAtTime(0.8, t);
                    mainGain.gain.linearRampToValueAtTime(0, t + 0.8);
                    break;

                case 'echo': // 金属的なエコー弾
                    osc.type = 'square';
                    osc.frequency.setValueAtTime(200, t);
                    mainGain.gain.setValueAtTime(0.2, t);
                    const f3 = ctx.createBiquadFilter(); f3.type = 'bandpass'; f3.frequency.value = 800;
                    osc.connect(f3); f3.connect(mainGain);
                    // 強烈なエコー
                    feedback.gain.value = 0.7;
                    mainGain.connect(delay); delay.connect(feedback); feedback.connect(delay); delay.connect(ctx.destination);
                    break;
                
                default: // その他はUFO系
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(100, t);
                    osc.frequency.linearRampToValueAtTime(1000, t + 0.4);
                    mainGain.gain.setValueAtTime(0.3, t);
            }

            if(type !== 'snare') {
                osc.connect(mainGain);
                osc.start(t); osc.stop(t + 1);
            }
            mainGain.connect(ctx.destination);
        }

        // ズレ防止
        window.addEventListener('scroll', () => window.scrollTo(0, 0));
        let lastT = 0;
        document.addEventListener('touchstart', e => {
            const now = Date.now();
            if (now - lastT < 300 || e.touches.length > 1) e.preventDefault();
            lastT = now;
        }, { passive: false });
    </script>
</body>
</html>
