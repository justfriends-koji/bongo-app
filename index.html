<!doctype html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>AI Manzai LIVE</title>

<style>
body{
  margin:0;
  background:#000;
  color:#fff;
  font-family:sans-serif;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:space-between;
  height:100vh;
  padding:40px 20px;
}

.stage{
  width:90%;
  max-width:420px;
  height:45%;
  background:radial-gradient(circle at bottom,#333,#000);
  border-bottom:8px solid #b00;
  border-radius:20px;
  display:flex;
  justify-content:center;
  align-items:flex-end;
  gap:40px;
  position:relative;
}

.comic{
  width:70px;
  height:130px;
  background:#fff;
  border-radius:35px 35px 5px 5px;
  transition:.12s;
}

.mic{
  width:8px;
  height:110px;
  background:#777;
  position:absolute;
  bottom:0;
  left:50%;
  transform:translateX(-50%);
}

#caption{
  width:95%;
  min-height:130px;
  background:rgba(255,255,255,.08);
  border-radius:16px;
  padding:18px;
  text-align:center;
  display:flex;
  align-items:center;
  justify-content:center;
  color:#0f0;
  font-size:1.2rem;
}

button{
  width:80%;
  padding:22px;
  border-radius:50px;
  border:none;
  font-size:18px;
  font-weight:bold;
  background:#d2b48c;
  box-shadow:0 6px 0 #5d2e0c;
}
button:active{
  transform:translateY(4px);
  box-shadow:0 2px 0 #5d2e0c;
}
</style>
</head>

<body>

<div id="caption">ボタンを押すとAIがネタ生成します</div>

<div class="stage">
<div id="a" class="comic"></div>
<div class="mic"></div>
<div id="b" class="comic"></div>
</div>

<button onclick="go()">新ネタを生成する</button>

<script>

const PROMPT =
"あなたは日本一の漫才師です。AとBの掛け合いで短い漫才を書いてください。必ずA: B:形式で最後は『もうええわ！』で終わる。";

async function go(){

document.getElementById("caption").innerText="ネタ生成中...";

try{

// ★安全版：自分のVercel APIを叩く
const r = await fetch("/api/manzai",{
method:"POST",
headers:{ "Content-Type":"application/json" },
body:JSON.stringify({ prompt:PROMPT })
});

const data = await r.json();

const text =
data?.candidates?.[0]?.content?.parts?.[0]?.text;

if(!text) throw "AI返答なし";

play(text);

}catch(e){
document.getElementById("caption").innerText="エラー：API通信失敗";
console.error(e);
}

}

function play(t){

const lines =
t.split("\n").filter(x=>/^[AB][:：]/.test(x));

let i=0;

function next(){

if(i>=lines.length) return;

const line=lines[i];
document.getElementById("caption").innerText=line;

const id=line.startsWith("A")?"a":"b";
const el=document.getElementById(id);

el.style.transform="translateY(-20px)";
setTimeout(()=>el.style.transform="translateY(0)",200);

i++;
setTimeout(next,2100);
}

next();
}

</script>

</body>
</html>
